# GCC-PHAT LDV-MIC 完整實驗報告

**報告日期**: 2026-01-29
**資料來源**: `/home/sbplab/jiawei/data/`
**分析腳本**: `full_analysis.py`

---

## 1. 實驗背景與動機

### 1.1 問題描述

在遠距離聲源定位情境中，麥克風陣列（MIC-MIC）的 TDOA（Time Difference of Arrival）估計品質受限於 SNR。當聲源距離麥克風超過 2 公尺，且音量較低時，MIC-MIC 的互相關峰值劣化，導致無法可靠地估計 TDOA。

### 1.2 構想

使用雷射都卜勒振動計（LDV）照射距離聲源較近的物體（如紙箱），利用 LDV 接收端的高 SNR 優勢，與遠端麥克風配對（LDV-MIC），以提升 GCC-PHAT 互相關品質。

---

## 2. 實驗目的

1. **驗證 GCC-PHAT 演算法在不同音量下的可靠性**（MIC-MIC 基線測試）
2. **比較 LDV-MIC vs MIC-MIC 在低 SNR 語音情境下的 GCC-PHAT 品質**
3. **評估 LDV 設備系統延遲**
4. **驗證檔案命名正確性**（LEFT/RIGHT 對應）

---

## 3. 預期結果

1. MIC-MIC 在高 SNR（chirp 訊號）下能準確測量 TDOA
2. LDV-MIC 在低 SNR 語音情境下互相關品質（Peak/PAR/PSR）優於 MIC-MIC
3. LDV 存在可校正的設備延遲

---

## 4. 實驗設計

### 4.1 設備配置

```
                    y (m)
                    ↑
                    │
        LEFT MIC    │    RIGHT MIC
        (-0.7, 2.0) │    (+0.7, 2.0)
            ●───────┼───────●          y = 2.0 m
                    │
                    │
                ┌───┴───┐
                │  LDV  │              y = 0.5 m
                │  BOX  │
                └───────┘
                (0, 0.5)
                    │
    ────────────────┼────────────────  y = 0 m
    ●       ●       ●       ●       ●
  -0.8    -0.4     0.0    +0.4    +0.8
  (22)    (21)    (20)    (19)    (18)   ← Speaker 位置
```

### 4.2 關鍵參數

| 參數 | 數值 |
|------|------|
| 取樣率 | 48,000 Hz |
| 音速 | 343 m/s (20°C) |
| 麥克風間距 | 1.4 m |
| LEFT MIC 位置 | (-0.7, 2.0) m |
| RIGHT MIC 位置 | (+0.7, 2.0) m |
| LDV Box 位置 | (0, 0.5) m |
| 最大搜索延遲 | 10 ms |

### 4.3 實驗階段

#### 階段一：音量敏感度測試

| 資料夾 | 音量 | Speaker | 訊號 | 感測器 |
|--------|------|---------|------|--------|
| 03-0.3V | 0.3V | +0.8m | chirp | MIC-MIC |
| 04-0.1V | 0.1V | +0.8m | chirp | MIC-MIC |
| 05-0.01V | 0.01V | +0.8m | chirp | MIC-MIC |
| 07-0.005V | 0.005V | +0.8m | chirp | MIC-MIC |
| 06-0.001V | 0.001V | +0.8m | chirp | MIC-MIC |

#### 階段二：LDV vs MIC 比較

| 資料夾 | Speaker 位置 | 訊號 | 感測器 |
|--------|-------------|------|--------|
| 18-0.1V | +0.8m | 0.1V boy 語音 | LDV + LEFT + RIGHT |
| 19-0.1V | +0.4m | 0.1V boy 語音 | LDV + LEFT + RIGHT |
| 20-0.1V | 0.0m | 0.1V boy 語音 | LDV + LEFT + RIGHT |
| 21-0.1V | -0.4m | 0.1V boy 語音 | LDV + LEFT + RIGHT |
| 22-0.1V | -0.8m | 0.1V boy 語音 | LDV + LEFT + RIGHT |

#### 階段三：Chirp 校準

| 資料夾 | Speaker 位置 | 訊號 | 感測器 |
|--------|-------------|------|--------|
| 23-chirp(-0.8m) | -0.8m | chirp | LDV + LEFT + RIGHT |
| 24-chirp(-0.4m) | -0.4m | chirp | LDV + LEFT + RIGHT |

---

## 5. 實驗方法

### 5.1 GCC-PHAT 演算法

使用 Generalized Cross-Correlation with Phase Transform：

$$R_{12}(f) = \frac{X_1(f) \cdot X_2^*(f)}{|X_1(f) \cdot X_2^*(f)| + \epsilon}$$

$$r_{12}(\tau) = \mathcal{F}^{-1}\{R_{12}(f)\}$$

$$\hat{\tau} = \arg\max_\tau |r_{12}(\tau)|$$

其中 $\epsilon = 10^{-10}$ 防止除零。

### 5.2 拋物線插值

在粗略峰值 $k$ 附近使用三點拋物線插值獲得亞樣本精度：

$$\delta = \frac{y_{k-1} - y_{k+1}}{2(y_{k-1} - 2y_k + y_{k+1})}$$

理論解析度從 $1/f_s = 0.0208$ ms 提升至約 0.001 ms。

### 5.3 帶通濾波

階段二使用 Butterworth 5 階帶通濾波 500-2000 Hz，消除低頻干擾（11-60 Hz）。分析片段取 100-600 秒。

階段一和三使用全段、無濾波（chirp 本身為寬頻訊號）。

### 5.4 品質指標

| 指標 | 定義 | 說明 |
|------|------|------|
| **Peak** | GCC-PHAT 最大值 | 0-1，越高越好 |
| **PAR** | Peak / mean(\|cc\|) | 峰均比，越高越好 |
| **PSR** | 20·log₁₀(Peak / max(sidelobes)) | 峰旁瓣比 (dB)，排除主峰 ±50 樣本 |

PSR 參考：>20 dB 良好，>30 dB 優秀。

---

## 6. 實驗結果

### 6.1 階段一：音量敏感度（MIC-MIC, chirp, Speaker @ +0.8m）

理論 TDOA: **1.4504 ms**（路徑差 49.75 cm）

| 資料夾 | 音量 (V) | τ (ms) | Peak | PAR | PSR (dB) | 路徑差 (cm) | 誤差 | 狀態 |
|--------|----------|--------|------|-----|----------|------------|------|------|
| 03-0.3V | 0.3 | 1.4569 | 0.3082 | 26.0 | 6.75 | 49.97 | +0.44% | ✓ |
| 04-0.1V | 0.1 | 1.4577 | 0.2942 | 26.1 | 7.01 | 50.00 | +0.50% | ✓ |
| 05-0.01V | 0.01 | 1.4581 | 0.1780 | 27.6 | 6.79 | 50.01 | +0.53% | ✓ |
| 07-0.005V | 0.005 | 1.4594 | 0.1238 | 26.3 | 6.47 | 50.06 | +0.62% | ✓ |
| 06-0.001V | 0.001 | 0.0003 | 0.0575 | 22.5 | 8.63 | 0.01 | -99.98% | ❌ |

**結論**：GCC-PHAT 在 60 倍音量範圍（0.005V~0.3V）內穩定，平均誤差僅 0.52%。臨界失敗點在 0.001V~0.005V 之間。

### 6.2 階段二：LDV vs MIC（0.1V boy 語音, 500-2000Hz, 100-600s）

#### 18-0.1V (Speaker @ +0.8m)

| 配對 | τ (ms) | 理論 τ (ms) | Peak | PAR | PSR (dB) |
|------|--------|------------|------|-----|----------|
| MIC-MIC | -0.0141 | +1.4504 | 0.0928 | 18.9 | 4.82 |
| LDV-LEFT | +0.0130 | -4.5382 | 0.0997 | 38.7 | 19.69 |
| **LDV-RIGHT** | **+0.0006** | **-3.0878** | **0.8507** | **187.0** | **37.97** |

Δτ 符號判定：❌ 不一致

#### 19-0.1V (Speaker @ +0.4m)

| 配對 | τ (ms) | 理論 τ (ms) | Peak | PAR | PSR (dB) |
|------|--------|------------|------|-----|----------|
| MIC-MIC | -1.6841 | +0.7585 | 0.0509 | 10.2 | 2.67 |
| **LDV-LEFT** | **-0.0011** | **-4.7878** | **0.5113** | **90.3** | **26.53** |
| LDV-RIGHT | +0.0179 | -4.0293 | 0.4761 | 72.2 | 26.41 |

Δτ 符號判定：✅ 一致

#### 20-0.1V (Speaker @ 0.0m)

| 配對 | τ (ms) | 理論 τ (ms) | Peak | PAR | PSR (dB) |
|------|--------|------------|------|-----|----------|
| MIC-MIC | +0.0027 | 0.0000 | 0.2597 | 43.5 | 14.16 |
| **LDV-LEFT** | **+0.0188** | **-4.7200** | **0.7835** | **122.6** | **29.91** |
| LDV-RIGHT | -0.0195 | -4.7200 | 0.2990 | 49.7 | 21.15 |

Δτ 符號判定：✅（理論 Δτ=0，測量值接近 0）

#### 21-0.1V (Speaker @ -0.4m)

| 配對 | τ (ms) | 理論 τ (ms) | Peak | PAR | PSR (dB) |
|------|--------|------------|------|-----|----------|
| **MIC-MIC** | **+0.0004** | **-0.7585** | **0.7318** | **113.5** | **23.54** |
| LDV-LEFT | +3.0383 | -4.0293 | 0.0299 | 6.3 | 2.31 |
| LDV-RIGHT | +0.0224 | -4.7878 | 0.2750 | 43.0 | 20.03 |

Δτ 符號判定：✅ 一致

#### 22-0.1V (Speaker @ -0.8m)

| 配對 | τ (ms) | 理論 τ (ms) | Peak | PAR | PSR (dB) |
|------|--------|------------|------|-----|----------|
| MIC-MIC | -0.0232 | -1.4504 | 0.3272 | 55.3 | 16.26 |
| **LDV-LEFT** | **+0.0015** | **-3.0878** | **0.7239** | **135.7** | **28.58** |
| LDV-RIGHT | +0.0231 | -4.5382 | 0.0789 | 14.8 | 9.32 |

Δτ 符號判定：❌ 不一致

#### 五組綜合比較

| 資料夾 | Speaker | MIC Peak | LDV-L Peak | LDV-R Peak | MIC PAR | LDV-L PAR | LDV-R PAR | 命名 |
|--------|---------|----------|------------|------------|---------|-----------|-----------|------|
| 18-0.1V | +0.8m | 0.0928 | 0.0997 | **0.8507** | 18.9 | 38.7 | **187.0** | ❌ |
| 19-0.1V | +0.4m | 0.0509 | **0.5113** | 0.4761 | 10.2 | **90.3** | 72.2 | ✅ |
| 20-0.1V | 0.0m | 0.2597 | **0.7835** | 0.2990 | 43.5 | **122.6** | 49.7 | ✅ |
| 21-0.1V | -0.4m | **0.7318** | 0.0299 | 0.2750 | **113.5** | 6.3 | 43.0 | ✅ |
| 22-0.1V | -0.8m | 0.3272 | **0.7239** | 0.0789 | 55.3 | **135.7** | 14.8 | ❌ |

### 6.3 階段三：Chirp 校準

#### 23-chirp(-0.8m) (Speaker @ -0.8m, 18.77s)

| 配對 | τ (ms) | 理論 τ (ms) | Peak | PAR | PSR (dB) |
|------|--------|------------|------|-----|----------|
| MIC-MIC | -1.3071 | -1.4504 | 0.2218 | 28.3 | 10.26 |
| LDV-LEFT | -2.7561 | -3.0878 | 0.0751 | 12.6 | 6.04 |
| LDV-RIGHT | -4.0649 | -4.5382 | 0.0683 | 10.8 | 6.44 |

MIC-MIC 誤差：9.88%（方向正確）

#### 24-chirp(-0.4m) (Speaker @ -0.4m, 18.26s)

| 配對 | τ (ms) | 理論 τ (ms) | Peak | PAR | PSR (dB) |
|------|--------|------------|------|-----|----------|
| MIC-MIC | -0.6339 | -0.7585 | 0.1919 | 22.8 | 7.49 |
| LDV-LEFT | -2.6830 | -4.0293 | 0.0432 | 6.7 | 4.56 |
| LDV-RIGHT | -2.7245 | -4.7878 | 0.0414 | 6.3 | 0.08 |

MIC-MIC 誤差：16.43%（方向正確）

---

## 7. 分析與討論

### 7.1 LDV-MIC vs MIC-MIC 品質比較

**觀察到的模式**：LDV-MIC 品質高度依賴 Speaker 與 LDV Box 的相對位置。

LDV Box 固定在 (0, 0.5)。當 Speaker 越靠近 LDV Box 正下方（x=0），LDV 接收的 SNR 越高。具體表現：

- **Speaker 在 LDV 同側或正下方 (0.0~+0.8m)**：LDV-LEFT 通常品質最高（20-0.1V Peak=0.78，19-0.1V Peak=0.51），大幅優於 MIC-MIC
- **18-0.1V（+0.8m）例外**：LDV-RIGHT 反而最高（Peak=0.85），而 MIC-MIC 和 LDV-LEFT 都很差，原因待查
- **21-0.1V（-0.4m）**：MIC-MIC 反而最佳（Peak=0.73），LDV-LEFT 極差（Peak=0.03），說明 Speaker 偏離 LDV 照射區域時 LDV 失效

**結論**：LDV-MIC 在 Speaker 靠近 LDV 照射目標時確實能提供更好的互相關品質，但在 Speaker 遠離時反而比 MIC-MIC 更差。這符合預期——LDV 的優勢來自「照射目標靠近聲源」這個條件。

### 7.2 LDV 設備延遲估算

從階段二數據估算（τ_measured - τ_theory）：

| 資料夾 | LDV-LEFT 延遲 | LDV-RIGHT 延遲 | 平均 |
|--------|---------------|----------------|------|
| 18-0.1V | 4.551 ms | 3.088 ms | 3.82 ms |
| 19-0.1V | 4.787 ms | 4.047 ms | 4.42 ms |
| 20-0.1V | 4.739 ms | 4.701 ms | 4.72 ms |
| 21-0.1V | 7.068 ms | 4.810 ms | 5.94 ms* |
| 22-0.1V | 3.089 ms | 4.561 ms | 3.83 ms |

*21-0.1V LDV-LEFT 延遲異常高（7.07 ms），該配對 Peak 僅 0.03，數據不可靠。

排除異常值後，**LDV 設備延遲估計為 3.8~4.8 ms，中位數約 4.5 ms**。

Chirp 數據（23, 24）的延遲估算明顯偏低（0.3~2.1 ms），與語音數據不一致，可能因為 chirp 錄音條件不同（短錄音、無濾波、Speaker 在負側）。

### 7.3 檔案命名驗證（符號分析）

使用 Δτ = τ(LDV-LEFT) - τ(LDV-RIGHT) 的符號判定 LEFT/RIGHT 命名是否正確。

理論上：
- Speaker 在正側 (+x)：LEFT MIC 距離更遠 → τ(LDV-LEFT) 更負 → Δτ < 0
- Speaker 在負側 (-x)：RIGHT MIC 距離更遠 → τ(LDV-RIGHT) 更負 → Δτ > 0
- Speaker 在中央 (x=0)：Δτ ≈ 0

| 資料夾 | Speaker | 理論 Δτ 符號 | 測量 Δτ 符號 | 一致？ |
|--------|---------|-------------|-------------|--------|
| 18-0.1V | +0.8m | 負 | **正** | ❌ |
| 19-0.1V | +0.4m | 負 | 負 | ✅ |
| 20-0.1V | 0.0m | ≈0 | ≈0 | ✅ |
| 21-0.1V | -0.4m | 正 | 正 | ✅ |
| 22-0.1V | -0.8m | 正 | **負** | ❌ |

3/5 一致。不一致的 18 和 22 恰好是 Speaker 在最遠端（±0.8m）的情況，此時其中一個 LDV-MIC 配對品質極差（Peak < 0.1），導致 τ 估計不可靠。

**結論**：在 LDV 訊號品質足夠的條件下（19、20、21），符號分析確認檔案命名正確。

### 7.4 低頻干擾問題

在 19-0.1V 的 MIC-MIC 結果中觀察到 τ = -1.6841 ms（而非理論的 +0.7585 ms）。此數值對應 ~11 Hz 的低頻干擾，在未濾波或濾波不完全時會主導 GCC-PHAT 結果。500-2000 Hz 帶通濾波在大多數情況下能有效抑制此干擾，但 19-0.1V 的 MIC-MIC 仍受影響（Peak 僅 0.05）。

### 7.5 Chirp vs 語音的定位精度

| 條件 | MIC-MIC 誤差 | Peak |
|------|-------------|------|
| 階段一 chirp（0.005~0.3V, +0.8m）| 0.4~0.6% | 0.12~0.31 |
| 階段三 chirp（-0.4m, -0.8m）| 9.9~16.4% | 0.19~0.22 |
| 階段二語音（0.1V, 五位置）| ~99% | 0.05~0.73 |

Chirp 訊號的定位精度遠優於連續語音，但階段三的 chirp（Speaker 在負側）精度也明顯低於階段一（Speaker 在 +0.8m）。這可能與 Speaker 位置靠近某支麥克風（MIC1 @ -0.7m）時產生的近場效應有關。

---

## 8. 結論與建議

### 8.1 主要結論

1. **GCC-PHAT 演算法可靠**：在 chirp 訊號、0.005V 以上音量時，MIC-MIC TDOA 誤差 < 1%。
2. **LDV-MIC 在特定條件下優於 MIC-MIC**：當 Speaker 靠近 LDV 照射目標時，LDV-MIC 的 Peak/PAR/PSR 可大幅超越 MIC-MIC（如 20-0.1V LDV-LEFT Peak=0.78 vs MIC-MIC Peak=0.26）。
3. **LDV-MIC 的限制**：當 Speaker 遠離 LDV 照射目標時，LDV-MIC 品質可能劣於 MIC-MIC（如 21-0.1V LDV-LEFT Peak=0.03）。
4. **LDV 設備延遲約 3.8~4.8 ms**，需要校正後才能用於絕對 TDOA 測量。
5. **低 SNR 連續語音下，兩種方法都無法準確測量絕對 TDOA**（誤差 ~99%），但 LDV-MIC 的互相關品質指標仍可用於相對比較和命名判定。
6. **檔案命名確認正確**（在 LDV 訊號品質足夠的條件下）。

### 8.2 建議

1. **使用 chirp 或脈衝訊號校正 LDV 延遲**，在延遲校正後再用 LDV-MIC 做 TDOA
2. **LDV 照射目標應盡量靠近聲源**，以充分發揮 SNR 優勢
3. **帶通濾波 500-2000 Hz** 是必要的前處理步驟
4. 後續可嘗試**分段統計方法**（多個短片段取中位數）提升穩健性
5. 考慮在**消聲室**環境重複實驗以排除房間反射影響

---

## 附錄 A：理論 TDOA 計算

### 距離公式

- $d_{left} = \sqrt{(x_{spk} - (-0.7))^2 + 2.0^2}$
- $d_{right} = \sqrt{(x_{spk} - (+0.7))^2 + 2.0^2}$
- $d_{ldv} = \sqrt{(x_{spk} - 0)^2 + (0 - 0.5)^2}$

### 各位置理論值

| Speaker X | d_left (m) | d_right (m) | d_ldv (m) | MIC-MIC τ (ms) | LDV-LEFT τ (ms) | LDV-RIGHT τ (ms) |
|-----------|-----------|------------|----------|----------------|-----------------|------------------|
| +0.8m | 2.500 | 2.002 | 0.943 | +1.450 | -4.538 | -3.088 |
| +0.4m | 2.285 | 2.022 | 0.640 | +0.759 | -4.788 | -4.029 |
| 0.0m | 2.119 | 2.119 | 0.500 | 0.000 | -4.720 | -4.720 |
| -0.4m | 2.022 | 2.285 | 0.640 | -0.759 | -4.029 | -4.788 |
| -0.8m | 2.002 | 2.500 | 0.943 | -1.450 | -3.088 | -4.538 |

---

## 附錄 B：分析程式碼

完整分析腳本見 `full_analysis.py`。核心函數：

- `gcc_phat()`: GCC-PHAT + 拋物線插值 + Peak/PAR/PSR 計算
- `bandpass_filter()`: Butterworth 5 階帶通濾波
- `calc_theory()`: 理論 TDOA 計算

---

*報告生成時間: 2026-01-29*
