# LDV-MIC GCC-PHAT 解耦驗證實驗指南

> **版本**: v1.0 (2026-02-23)
> **目的**: 作為每次進無響室/實驗室之前的 checklist，確保實驗配置對齊理論預測

---

## 1. 理論核心公式

### 1.1 MIC-MIC 的數學死局

聲波穿透板材時，左右麥克風透過板上**不同的點** (wL, wR) 接收訊號。
互相關相位中包含**無法消去**的牆壁折射項：

```
angle(Phi_LR) = -k * [(d(S,wL)+d(wL,L)) - (d(S,wR)+d(wR,R))]
                - [phi_wall(theta_L) - phi_wall(theta_R)]
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                    未知系統性誤差，無法消去
```

### 1.2 LDV 解耦的代數奇蹟

LDV 測量板上 v 點的振動速度 X_V。對 LDV 和 MIC 做共軛互相關：

```
Phi_VL = X_V * conj(X_L) = |U_v|^2 * B_L * exp(j*(k*d(v,L) - pi/2))
                             ^^^^^^^^
                             純實數！牆外路徑 + 牆壁折射 被徹底消去
```

最終 TDOA：

```
Delta_tau = tau_VR - tau_VL = [d(v,R) - d(v,L)] / c
```

**只剩 LDV 打點到兩個麥克風的純幾何距離差。與聲源位置無關。**

---

## 2. 實驗幾何配置

### 2.1 標準幾何佈局

```
                         y (m)
                         ^
                         |
   2.0  MIC_L(-0.7, 2.0) ●================● MIC_R(+0.7, 2.0)
                         |   d_mic = 1.4 m  |
                         |                  |
                         |                  |
   ~0.5 =====[板材]======●===================[板材]=====
                    LDV打點 v (x_v, ~0.5)
                         |
                         |    LDV 雷射從 y>0.5 方向射入
                         |    (與板同側，面對麥克風)
                         |
   0.0  --------●--------+----------------------------> x (m)
           Speaker (x_s, 0)
```

### 2.2 座標定義

| 元件 | 座標 | 備註 |
|------|------|------|
| MIC LEFT (L) | (-0.7, 2.0) m | 固定 |
| MIC RIGHT (R) | (+0.7, 2.0) m | 固定 |
| 板材 (Board) | y ≈ 0.5 m | 垂直放置，面向 y 軸 |
| LDV 打點 (v) | (x_v, ~0.5) m | **需精確測量** |
| 喇叭 (Speaker) | (x_s, 0.0) m | 板材的另一側 |

### 2.3 距離公式

```
d(v, L) = sqrt( (x_v - (-0.7))^2 + (0.5 - 2.0)^2 )
         = sqrt( (x_v + 0.7)^2 + 2.25 )

d(v, R) = sqrt( (x_v - 0.7)^2 + 2.25 )

理論 TDOA:
  Delta_tau_geo = [d(v,R) - d(v,L)] / c    (c = 343 m/s)

理論 DoA:
  theta = arcsin(Delta_tau_geo * c / d_mic)  (d_mic = 1.4 m)
```

### 2.4 關鍵常數

| 參數 | 值 |
|------|------|
| 聲速 c | 343 m/s |
| 取樣率 fs | 48,000 Hz |
| 麥克風間距 d_mic | 1.4 m |
| 每 sample 時間 | 0.02083 ms |

---

## 3. 四個驗證子任務

### 3.1 子任務一：MIC-MIC 系統性折射偏差

**對應數學**: 證明 phi_wall(theta_L) - phi_wall(theta_R) != 0

```
目標：證明紙板遮擋下，純麥克風 GCC-PHAT 有系統性偏差

步驟：
  1. 喇叭播放訊號（Chirp 或語音）
  2. 錄製 MIC_L, MIC_R
  3. 計算 GCC-PHAT(MIC_L, MIC_R)，找波峰 -> tau_LR
  4. 將 tau_LR 轉成 DoA

Pass 標準：
  ✅ GCC-PHAT 有清晰波峰（無響室 SNR 高）
  ✅ 但波峰位置 != 喇叭的真實幾何 DoA
  ✅ 偏差量 = phi_wall 造成的系統性誤差（非隨機）
```

**已有實驗結果**:

| 資料集 | MIC-MIC DoA 誤差 | 狀態 |
|--------|------------------|------|
| block (低打點) | -4.80° | 偏差存在 |
| block-2 (低打點) | -10.70° | 偏差明顯 |
| block-3 (高打點) | +79.29° | MIC-MIC 完全崩潰 |

### 3.2 子任務二：速度→聲壓的 90° 相位偏移

**對應數學**: 證明二次輻射常數 exp(-j*pi/2) 存在

```
目標：證明 LDV（速度）與近場麥克風（壓力）之間存在 +-90° 相移

                LDV 雷射
                   |
                   v
   =====[板材]=====●===== v 點
                   |
                   ● MIC_far (距 v 點 < 5 cm)
                   |

步驟：
  1. 將一根麥克風 (MIC_far) 貼近 LDV 打點 v（< 5 cm）
  2. 播放訊號，同時錄製 LDV 和 MIC_far
  3. 計算交叉頻譜相位：angle(X_V * conj(X_Mic))
  4. 扣除傳播延遲後，觀察殘餘相位

Pass 標準：
  ✅ 在板材有效共振頻段內，相位差穩定在 +-90° 附近
  ✅ 相位 vs 頻率的線性回歸截距 ≈ +-90°
```

**已有實驗結果** (block-1, 低打點):

| 頻段 | 回歸截距 | 與 90° 差距 | 狀態 |
|------|---------|------------|------|
| 100-300 Hz | -90.7° | 0.7° | ✅ 非常好 |
| 1500-2000 Hz | +102.8° | 12.8° | ✅ 可接受 |
| 600-1500 Hz | 偏離大 | — | ❌ 板模態干擾 |

**改進方向**: 需用**高打點**重做，減少邊界效應

### 3.3 子任務三：LDV-MIC 絕對幾何解耦

**對應數學**: 證明 tau_VL = d(v,L)/c - 常數

```
目標：證明 LDV-MIC 的 GCC-PHAT 波峰 = 純幾何距離 / c

步驟：
  1. 錄製 LDV, MIC_L, MIC_R
  2. 計算 GCC-PHAT(LDV, MIC_L) -> 找波峰 tau_VL
  3. 計算 GCC-PHAT(LDV, MIC_R) -> 找波峰 tau_VR
  4. 比較 tau_VL * c 與雷射尺測量的 d(v,L)

Pass 標準：
  ✅ tau_VL * c ≈ d(v,L)（扣除輻射常數後，誤差 < 數公分）
  ✅ tau_VR * c ≈ d(v,R)
  ✅ 與牆外喇叭位置無關
```

**已有實驗結果**:

Oracle 搜尋（在理論值 ±0.5ms 內找最高峰）可以精確找到幾何距離對應的峰值。
但自動搜尋（全域最高峰）尚無法穩定鎖定正確峰值 — 因為殘響環境下其他峰值可能更高。

### 3.4 子任務四：空間不變性定理（終極驗證）

**對應數學**: 證明 Delta_tau = [d(v,R) - d(v,L)]/c 與聲源位置無關

```
目標：移動喇叭位置，Delta_tau_fusion 應為常數

步驟：
  1. 固定 LDV 打點 v、MIC_L、MIC_R
  2. 將喇叭放在不同位置 (x_s = -0.8, -0.4, 0.0, +0.4, +0.8)
  3. 每個位置都錄製 LDV + MIC_L + MIC_R
  4. 每次計算 Delta_tau = tau_VR - tau_VL

Pass 標準：
  ✅ 所有喇叭位置算出的 Delta_tau 都相同（標準差 < 0.1 ms）
  ✅ 該常數 = d(v,R)-d(v,L))/c = 雷射尺量出的幾何值
```

**此子任務尚未有實驗數據。** 需要在同一次實驗中，固定所有感測器位置，只移動喇叭。

---

## 4. 實驗配置清單

### 4.1 基本配置（子任務 1, 3, 4）

```
所需設備：
  [ ] 喇叭 x1（可移動）
  [ ] 麥克風 x2（MIC_L, MIC_R，固定在 y=2.0m）
  [ ] LDV x1（雷射打在板材上）
  [ ] 板材 x1（紙板或壓克力，立在 y≈0.5m）
  [ ] 雷射測距儀（量 LDV 打點座標、到麥克風距離）
  [ ] 錄音介面（3 通道同步：MIC_L, MIC_R, LDV）

錄製：
  [ ] MIC_LEFT.wav
  [ ] MIC_RIGHT.wav
  [ ] LDV.wav
```

### 4.2 子任務二專用配置

```
額外所需：
  [ ] 麥克風 x1（MIC_far，貼近 LDV 打點 < 5 cm）

                    LDV 雷射
                       |
                       v
      =====[板材]=====●======
                  v 點 |
                       ● MIC_far (< 5 cm)

錄製（2 通道）：
  [ ] LDV.wav
  [ ] MIC_far.wav
```

### 4.3 子任務四專用要求

```
關鍵：所有感測器位置完全固定，只移動喇叭！

  錄 5 組（或更多）：
    [ ] Speaker at x = -0.8 m
    [ ] Speaker at x = -0.4 m
    [ ] Speaker at x =  0.0 m
    [ ] Speaker at x = +0.4 m
    [ ] Speaker at x = +0.8 m

  每組 3 通道：MIC_L + MIC_R + LDV
```

---

## 5. 關鍵實驗注意事項（Lessons Learned）

### 5.1 LDV 打點位置：必須遠離板材邊緣

```
                    邊緣（邊界效應強）
                    ↓
   ┌────────────────────────────────────┐
   │  ✗ 不要打這裡                      │
   │                                    │
   │         ✓ 打這裡（中央偏上）        │  板材
   │           (高打點)                  │
   │                                    │
   │  ✗ 不要打這裡                      │
   └────────────────────────────────────┘
                    ↑
                    邊緣（邊界效應強）
```

**實驗證據**:
- block/block-2（低打點）：VR 理論值峰排名 #3-#5，自動選峰困難
- block-3（高打點）：VR 理論值峰排名 **#1**，11.3x DoA 改善

**建議**: LDV 打點距離板材任何邊緣至少 **15 cm 以上**

### 5.2 板材選擇

| 材料 | TL (dB) | 穿透率 | LDV 理論適用性 |
|------|---------|--------|---------------|
| 5mm 鋼板 | 35-50 | < 0.01% | ❌ 不透聲，聲靠繞射 |
| 一般紙板 | 10-20 | 1-10% | ✅ 穿透模型適用 |
| 壓克力 (3-5mm) | 15-25 | 0.3-3% | ✅ 適用，且更穩定 |
| 石膏板 | 20-30 | 0.1-1% | ✅ 適用 |

**建議**: 使用**一般紙板**或**薄壓克力**，確保聲音可穿透。避免金屬板。

### 5.3 子任務二的 MIC_far 距離

```
MIC_far 必須非常靠近 LDV 打點（< 5 cm），原因：
  - 距離太遠 -> 傳播延遲的頻率依賴性蓋過 90° 常數相移
  - 距離太遠 -> 接收到板材其他位置的輻射（非 v 點），相位混雜
```

### 5.4 訊號選擇

| 訊號 | 優點 | 缺點 | 建議 |
|------|------|------|------|
| Chirp (100-8000 Hz) | 脈衝壓縮後極尖銳、頻段可控 | 非真實場景 | **子任務 2, 4 優先使用** |
| 語音 (boy speech) | 真實場景、有意義 | 頻譜不均勻 | 子任務 1, 3 可用 |

### 5.5 必須精確記錄的數據

每次實驗**必須**用雷射測距儀或卷尺記錄：

```
  [ ] LDV 打點座標 (x_v, y_v) — 精度 ±1 cm
  [ ] MIC_L 座標 — 確認 (-0.7, 2.0)
  [ ] MIC_R 座標 — 確認 (+0.7, 2.0)
  [ ] Speaker 座標 (x_s, y_s)
  [ ] 板材到原點距離 (y_board)
  [ ] LDV 打點到板材上/下/左/右邊緣的距離（判斷邊界效應）
```

**缺少這些數據 = 無法計算理論值 = 實驗白做！**

---

## 6. 預期量化結果

### 6.1 數值範例：LDV 打點在 (0, 0.5)

```
d(v, L) = sqrt(0.7^2 + 1.5^2) = sqrt(0.49 + 2.25) = sqrt(2.74) = 1.655 m
d(v, R) = sqrt(0.7^2 + 1.5^2) = sqrt(0.49 + 2.25) = sqrt(2.74) = 1.655 m

tau_VL = 1.655 / 343 = 4.826 ms
tau_VR = 1.655 / 343 = 4.826 ms
Delta_tau = 0.000 ms  ->  DoA = 0°
```

### 6.2 數值範例：LDV 打點在 (+0.1, 0.5)

```
d(v, L) = sqrt(0.8^2 + 1.5^2) = sqrt(0.64 + 2.25) = sqrt(2.89) = 1.700 m
d(v, R) = sqrt(0.6^2 + 1.5^2) = sqrt(0.36 + 2.25) = sqrt(2.61) = 1.616 m

tau_VL = 1.700 / 343 = 4.956 ms
tau_VR = 1.616 / 343 = 4.711 ms
Delta_tau = -0.245 ms  ->  DoA = arcsin(-0.245*343/1400) = arcsin(-0.060) = -3.45°
```

### 6.3 各子任務預期結果摘要

| 子任務 | 觀測量 | 預期值 | 容許誤差 |
|--------|--------|--------|---------|
| 1. MIC-MIC 偏差 | DoA error | != 0° (系統性偏移) | 偏差 > 3° 即可證明 |
| 2. 90° 相移 | angle(X_V * conj(X_Mic)) | ±90° | ±15° (有效頻段內) |
| 3. 幾何解耦 | tau_VL * c | d(v,L) | < 5 cm (≈ 0.15 ms) |
| 4. 空間不變性 | Delta_tau across positions | 常數 | std < 0.1 ms |

---

## 7. 分析流程（GCC-PHAT 六步法）

```
輸入：sig1.wav, sig2.wav (fs = 48000 Hz)

Step 1: 讀取 WAV
Step 2: FFT
  X1 = fft(sig1),  X2 = fft(sig2)
Step 3: 交叉頻譜
  G = X1 * conj(X2)
Step 4: PHAT 白化
  G_phat = G / |G|
Step 5: IFFT
  gcc = real(ifft(G_phat))
Step 6: 找波峰
  tau = argmax(gcc) / fs    (轉成時間)
  theta = arcsin(tau * c / d_mic)
```

### 7.1 LDV-MIC 的先驗知識選峰策略（Strategy 2）

自動選峰時，全域最高峰可能不是正確的幾何峰。使用先驗知識：

```
先驗條件：
  |Delta_tau| <= 1.0 ms
  (因為 d_mic=1.4m, c=343 -> max TDOA = 1.4/343 = 4.08 ms，
   但合理 DoA 範圍 ±45° 內，TDOA < ~3 ms；
   解耦後的 Delta_tau 通常 < 1 ms)

步驟：
  1. 計算 tau_VL = argmax GCC(LDV, MIC_L)
  2. 計算 tau_VR = argmax GCC(LDV, MIC_R)
  3. Delta_tau = tau_VR - tau_VL
  4. 若 |Delta_tau| > 1.0 ms：
     在 tau_VR 附近 ±1.0ms 視窗內找次高峰，重新計算
  5. 加權：振幅越高的峰優先
```

---

## 8. 目前實驗進度總覽

### 8.1 已完成資料集

| 資料集 | 配置 | LDV打點 | 子任務 | 狀態 |
|--------|------|---------|--------|------|
| block (#13) | 3ch: L+R+LDV | 低 | 1,3 | ✅ 已分析 |
| block-2 (#15) | 3ch: L+R+LDV | 低 | 1,3 | ✅ 已分析 |
| block-3(high) (#16) | 3ch: L+R+LDV | **高** | 1,3 | ✅ 已分析 |
| block-1 (#14) | 2ch: far+near+LDV | 低 | 2 | ✅ 已分析 (部分) |

### 8.2 三資料集一致性結果

| 資料集 | MIC-MIC err | LDV Strat2 err | Oracle err | 改善倍數 |
|--------|-------------|----------------|------------|---------|
| block | -4.80° | -4.72° | +0.76° | ~1x |
| block-2 | -10.70° | -3.50° | -0.43° | 3.1x |
| block-3(high) | +79.29° | -7.01° | +1.18° | **11.3x** |

### 8.3 待補實驗

| 需求 | 原因 | 優先級 |
|------|------|--------|
| 子任務 2 高打點版 | block-1 低打點邊界效應大，需高打點 + MIC_far | ★★★ |
| 子任務 4 多位置版 | 需固定感測器、移動喇叭至 5+ 位置 | ★★★ |
| 精確 LDV 打點座標 | 目前只有估計值，無法計算精確理論值 | ★★★ |
| Chirp 訊號版本 | 現有資料用語音，Chirp 可提供更乾淨的脈衝響應 | ★★ |

---

## 9. 理想實驗方案（一次到位）

### 9.1 設備準備

```
[ ] 板材（紙板或薄壓克力）
[ ] 喇叭 x1 + 放大器
[ ] 麥克風 x3 (MIC_L, MIC_R, MIC_far)
[ ] LDV x1
[ ] 3-4 通道同步錄音介面
[ ] 雷射測距儀 or 卷尺（精度 ±1 cm）
[ ] 訊號源：Chirp (100-8000 Hz, 5-10 秒) + 語音
```

### 9.2 實驗步驟

```
Phase 0: 佈置與量測
  [ ] 固定 MIC_L 在 (-0.7, 2.0)
  [ ] 固定 MIC_R 在 (+0.7, 2.0)
  [ ] 立板材在 y ≈ 0.5
  [ ] LDV 打在板材中央偏上（距邊緣 > 15 cm）
  [ ] 用雷射測距儀精確記錄 v 點座標 (x_v, y_v)
  [ ] 計算理論值：
      d(v,L), d(v,R), Delta_tau_geo, DoA_geo

Phase 1: 子任務 1 + 3（基本配置，3 通道）
  [ ] 喇叭放在 (+0.4, 0.0)，播放 Chirp
  [ ] 錄製 MIC_L + MIC_R + LDV
  [ ] 重複 2-3 次（同位置多次錄製，確認重複性）

Phase 2: 子任務 2（加 MIC_far，4 通道）
  [ ] 將 MIC_far 貼近 v 點（< 5 cm）
  [ ] 播放 Chirp，錄製 LDV + MIC_far (+ 可選 MIC_L, MIC_R)
  [ ] 重複 2-3 次

Phase 3: 子任務 4（移動喇叭，3 通道）
  *** 所有感測器位置不動！只動喇叭！***
  [ ] 拆除 MIC_far（回到 3 通道）
  [ ] 喇叭位置 1: x = -0.8 m → 錄製
  [ ] 喇叭位置 2: x = -0.4 m → 錄製
  [ ] 喇叭位置 3: x =  0.0 m → 錄製
  [ ] 喇叭位置 4: x = +0.4 m → 錄製
  [ ] 喇叭位置 5: x = +0.8 m → 錄製

Phase 4: 確認量測
  [ ] 再次確認所有感測器座標（確保沒有碰歪）
  [ ] 記錄板材邊緣到 LDV 打點的距離
```

### 9.3 預期結果判讀流程

```
分析完成後，對照以下表格：

子任務 1:
  MIC-MIC DoA error 是否 > 3°？
    YES -> ✅ PASS（phi_wall 偏差確認存在）
    NO  -> 可能板材太薄或位置太正中

子任務 2:
  相位截距是否在 90° ± 15°？
    YES -> ✅ PASS（輻射阻抗 j*omega*rho 確認）
    NO  -> 檢查 MIC_far 距離、頻段選擇

子任務 3:
  tau_VL * c 是否 ≈ d(v,L)（誤差 < 5 cm）？
    YES -> ✅ PASS（幾何解耦確認）
    NO  -> 檢查 LDV 打點座標量測、選峰策略

子任務 4:
  5 組 Delta_tau 的 std 是否 < 0.1 ms？
    YES -> ✅ PASS（空間不變性確認）
    NO  -> 檢查感測器是否被碰動、板材是否穩定
```

---

## 10. 檔案命名規範

```
建議命名格式：
  {日期}-{感測器}-{喇叭ID}-{訊號類型}({位置})-{錄音編號}-{配置}.wav

範例：
  0223-MIC-LEFT-40-chirp(+0.4m)-01-block.wav
  0223-MIC-RIGHT-40-chirp(+0.4m)-01-block.wav
  0223-LDV-40-chirp(+0.4m)-01-block.wav
  0223-MIC-FAR-40-chirp(+0.4m)-01-block.wav

子任務 4 多位置範例：
  0223-LDV-40-chirp(-0.8m)-01-block.wav
  0223-LDV-40-chirp(-0.4m)-02-block.wav
  0223-LDV-40-chirp(+0.0m)-03-block.wav
  ...
```

---

## 附錄 A：快速參考卡

```
┌──────────────────────────────────────────────────────┐
│  LDV-MIC 解耦驗證 Quick Reference                    │
│                                                      │
│  核心公式:                                            │
│    Delta_tau = [d(v,R) - d(v,L)] / 343               │
│                                                      │
│  GCC-PHAT 先驗策略:                                   │
│    |Delta_tau| <= 1.0 ms + 振幅加權                   │
│                                                      │
│  打點注意:                                            │
│    距邊緣 > 15 cm，偏上方                             │
│                                                      │
│  板材:                                                │
│    紙板 or 薄壓克力（不要金屬板）                      │
│                                                      │
│  必量:                                                │
│    v 點座標、MIC 座標、Speaker 座標、邊緣距離          │
└──────────────────────────────────────────────────────┘
```
